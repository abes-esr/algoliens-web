{% extends "base.html.twig" %}
{% block javascripts %}
    <script type="text/javascript">
        var url_raw_record = "{{ url("raw_record", {'ppn': record.ppn}) }}";
    </script>
    {{ encore_entry_script_tags('record_view') }}
    <!-- Renders app.js & a webpack runtime.js file
        <script src="/build/runtime.js"></script>
        <script src="/build/app.js"></script> -->
{% endblock %}

{% block body %}
    <h1 id="h1iln">{{ iln.label }}</h1>
    <h1 id="h1rcr">{{ rcr.label }}</h1>
    {% if empty %}
        <div>
            Plus aucune notice à traiter pour ce RCR !<br/>
            Peut-être un <a href="{{ url('view_iln', {'code': iln.code}) }}">autre RCR de cet ILN</a> ?
        </div>
    {% else %}

        <h1 id="h1ppn">Notice n°<a href="http://www.sudoc.fr/{{ record.ppn }}">{{ record.ppn }}</a></h1>
        <hr/>
        <div>
            <h2>Erreurs trouvées</h2>
            <!--
            <p class="alert alert-secondary">
                Pour cette notice {{ record.ppn }}, les erreurs suivantes ont été identifiées par AlgoLiens. Elles peuvent être corrigées à l'aide de Winbiw, ou pour celles concernant les liens aux personnes, au travers de Paprika.
            </p>
            <ul>
                {% for linkError in record.linkErrors %}
                    <li>
                        {{ linkError.errorCode }} - Au moins {{ linkError.errorText}}
                        {% if linkError.paprikaLinks|length > 0 %}
                            <ul>
                                {% for paprikaLink in linkError.paprikaLinks %}
                                    <li>{{ paprikaLink.label }} &#8611; <a href="{{ paprikaLink.url }}">corriger à l'aide de Paprika</a></li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
            -->
            <table class="table table-bordered">
                <tr>
                    <th>Code erreur</th>
                    <th>Libellé erreur</th>
                    <th>Personne concernée</th>
                    <th>Action à mener</th>
                </tr>
                {% for linkError in record.linkErrors %}
                    {% if linkError.paprikaLinks|length > 0 %}
                        {% for paprikaLink in linkError.paprikaLinks %}
                            <tr>
                                <td>{{ linkError.errorCode }}</td>
                                <td>{{ linkError.errorText }}</td>
                                <td>{{ paprikaLink.label }}</td>
                                <td><pre><a href="{{ paprikaLink.url }}" target="_blank">Corriger à l'aide de Paprika</a><br/>ou<br/>Corriger dans Winibw</pre></td>
                            </tr>
                        {% endfor %}
                    {% else %}
                            <tr>
                                <td>{{ linkError.errorCode }}</td>
                                <td>{{ linkError.errorText }}</td>
                                <td><i>n/a</i></td>
                                <td><pre>Corriger dans Winibw</pre></td>
                            </tr>
                    {% endif %}
                {% endfor %}
            </table>
        </div>

        {{ form_start(form) }}
        <h2>Action menée sur la notice</h2>
        <div class="row">

            <div class="col-sm text-right">
                {{ form_widget(form.validate) }}
                <p>
                    <small>
                        Plus la peine de la proposer aux collègues
                    </small>
                </p>
            </div>
            <div class="col-sm text-left" style="border-left:2px solid grey">
                {{ form_widget(form.skip) }}
                <p>
                    <small>
                        Il me manque des éléments pour corriger cette notice.
                    </small>
                </p>
            </div>

        </div>
        {{ form_end(form) }}

        <div>
            <h2>Notice unimarc</h2>
            <div id="sudoc_record">
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
            </div>
        </div>
    {% endif %}
{% endblock %}
